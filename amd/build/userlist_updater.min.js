/*
 * The module provides a function to refresh the user list with correct credential data.
 *
 * @module    mod_accredible
 * @package   accredible
 * @copyright Accredible <dev@accredible.com>
 * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_accredible/userlist_updater",["jquery","core/ajax","core/templates"],(function($,Ajax,Templates){var t={init:function(){$("select#id_groupid").on("change",t.groupChanged),t.lastSelectedGroup=$("select#id_groupid").val(),t.courseid=$("input:hidden[name=course]").val(),t.instanceid=$("input:hidden[name=instance-id]").val(),t.userwarning=$(".manual-issue-warning"),t.manualuserscontainer=$("#manual-issue-users-container"),t.unissuedusers=$("#id_chooseunissuedusers"),t.unissuedusersmessage=$("#fitem_id_unissueddescription"),t.selectallbutton=$("#fitem_id_nosubmit_checkbox_controller1, #fitem_id_nosubmit_checkbox_controller2"),""===t.lastSelectedGroup&&(t.userwarning.removeClass("hidden"),t.manualuserscontainer.addClass("hidden")),0==$("#unissued-users-container .form-group").length&&t.unissuedusers.hide().addClass("collapsed")},groupChanged:function(){$("select#id_groupid").val()!==t.lastSelectedGroup&&(t.lastSelectedGroup=$("select#id_groupid").val(),""===t.lastSelectedGroup?t.displayNoUsersWarning():(Ajax.call([{methodname:"mod_accredible_reload_users",args:{courseid:t.courseid,groupid:$("select#id_groupid").val(),instanceid:t.instanceid}}])[0].done(t.updateUsers),t.userwarning.addClass("hidden"),t.manualuserscontainer.removeClass("hidden"),t.unissuedusersmessage.removeClass("hidden"),t.selectallbutton.removeClass("hidden")))},displayNoUsersWarning:function(){$("#manual-issue-users-container .form-group, #unissued-users-container .form-group").remove(),t.userwarning.removeClass("hidden"),t.selectallbutton.addClass("hidden"),t.manualuserscontainer.addClass("hidden"),t.unissuedusersmessage.addClass("hidden"),t.unissuedusers.show()},updateUsers:function(response){var context;$("#manual-issue-users-container .form-group, #unissued-users-container .form-group").remove(),$(response.users).each((function(index,user){context=user.credential_url?{element:{html:"Certificate "+user.credential_id+" - <a href="+user.credential_url+' target="_blank">link</a>',staticlabel:!0},label:user.name+"   "+user.email}:{element:{id:"id_users_"+user.id,name:"users["+user.id+"]",extraclasses:"checkboxgroup1",selectedvalue:1},label:user.name+"   "+user.email},t.renderUser(context,"#manual-issue-users-container",user.credential_url)})),response.unissued_users.length>0?(t.unissuedusers.show(),$(response.unissued_users).each((function(index,user){context={element:{id:"id_unissuedusers_"+user.id,name:"unissuedusers["+user.id+"]",extraclasses:"checkboxgroup2",selectedvalue:1},label:user.name+"   "+user.email},t.renderUser(context,"#unissued-users-container",null)}))):t.unissuedusers.hide().addClass("collapsed")},renderUser:function(context,containerid,certificate){var template=certificate?"core_form/element-static":"core_form/element-advcheckbox";Templates.renderForPromise(template,context).then((function(_ref){Templates.appendNodeContents(containerid,_ref.html,_ref.js)}))}};return t}));